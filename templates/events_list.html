{% extends 'basemain.html' %}
{% load static %}

{% block title %}{{ page_title }} - KFG Events{% endblock %}

{% block content %}
<div class="page-wrapper">

    <section class="events-page-section py-5">
        <div class="container">
            
            <!-- Upcoming Events Section -->
            <div class="upcoming-events-section mb-5">
                <div class="block-title text-left mb-4">
                    <h3>Stay Upto Date</h3>
                    <!-- <h2>Upcoming Events</h2> -->
                </div>
                {% if query %}
                    <p class="lead">Showing results for: "{{ query }}"</p>
                {% endif %}

                <div class="row">
                    {% for event_item in upcoming_events %}
                        <div class="col-12 mb-4"> 
                            <div class="news-one__single event-card-themed"> 
                                <div class="row g-0"> 
                                    
                                    <div class="col-md-4"> 
                                        <div class="news-one__img"> 
                                            <div class="news-one__img-box" style="position: relative;"> 
                                                <a href="{{ event_item.get_absolute_url }}">
                                                    {% if event_item.featured_image %}
                                                        <img src="{{ event_item.featured_image.url }}" alt="{{ event_item.title }}" class="event-card-image-themed">
                                                    {% else %}
                                                        <img src="{% static 'assets/images/default-event-placeholder.jpg' %}" alt="Default Event Image" class="event-card-image-themed">
                                                    {% endif %}
                                                </a>
                                                <div class="news-one__date-box event-date-themed"> 
                                                    <p>{{ event_item.start_datetime|date:"d" }} <br> {{ event_item.start_datetime|date:"M" }} <br> {{ event_item.start_datetime|date:"Y" }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-8"> 
                                        <div class="news-one__content event-content-themed"> 
                                            <ul class="list-unstyled news-one__meta">
                                                {% if event_item.category %}
                                                <li><i class="fas fa-folder-open"></i> {{ event_item.category.title }}</li>
                                            {% endif %}
                                                {% if event_item.location_name %}
                                                     {% if event_item.category %}<li><span>/</span></li>{% endif %}
                                                    <li><i class="fas fa-map-marker-alt"></i> {{ event_item.location_name }}</li>
                                                {% endif %}
                                            </ul>
                                            <div class="news-one__title">
                                                <h3><a href="{{ event_item.get_absolute_url }}">{{ event_item.title }}</a></h3>
                                            </div>
                                            <p class="event-datetime-themed mb-2">
                                                <small><i class="fas fa-clock"></i> {{ event_item.start_datetime|date:"D, d M Y, P" }}
                                                {% if event_item.end_datetime %}
                                                    to {{ event_item.end_datetime|date:"P" }}
                                                {% endif %}
                                                </small>
                                            </p>
                                            <p class="event-description-themed">
                                                {{ event_item.description|striptags|truncatewords:20 }} {# Shorter truncate for list view #}
                                            </p>
                                            <a href="{{ event_item.get_absolute_url }}" class="thm-btn news-one__btn">View Details</a>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-12">
                            <p>No upcoming events scheduled or matching your search. Please check back soon!</p>
                        </div>
                    {% endfor %}
                </div>

                <!-- Pagination for Upcoming Events -->
                {% if upcoming_events.has_other_pages %}
                <div class="row mt-4">
                    <div class="col-lg-12">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                {% if upcoming_events.has_previous %}
                                    <li class="page-item"><a class="page-link" href="?page=1{% if query %}&q={{ query }}{% endif %}">« First</a></li>
                                    <li class="page-item"><a class="page-link" href="?page={{ upcoming_events.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">Previous</a></li>
                                {% endif %}
                                
                                <li class="page-item disabled"><a class="page-link" href="#">Page {{ upcoming_events.number }} of {{ upcoming_events.paginator.num_pages }}</a></li>
                                
                                {% if upcoming_events.has_next %}
                                    <li class="page-item"><a class="page-link" href="?page={{ upcoming_events.next_page_number }}{% if query %}&q={{ query }}{% endif %}">Next</a></li>
                                    <li class="page-item"><a class="page-link" href="?page={{ upcoming_events.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}">Last »</a></li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
                {% endif %}
            </div>
            <!-- End Upcoming Events Section -->

            <hr class="my-5">

            <!-- Past Events Section -->
            <div class="past-events-section">
                <div class="block-title text-left mb-4">
                    <!-- <h4>From Our Archives</h4> -->
                    <h3>Past Events</h3>
                </div>
                <div class="row">
                    {% for event_item in past_events %}
                        <div class="col-12 mb-4">
                            <div class="news-one__single event-card-themed">
                                <div class="row g-0">
                                    
                                    <div class="col-md-4">
                                        <div class="news-one__img">
                                            <div class="news-one__img-box" style="position: relative;">
                                                <a href="{{ event_item.get_absolute_url }}">
                                                    {% if event_item.featured_image %}
                                                        <img src="{{ event_item.featured_image.url }}" alt="{{ event_item.title }}" class="event-card-image-themed">
                                                    {% else %}
                                                        <img src="{% static 'assets/images/default-event-placeholder.jpg' %}" alt="Default Event Image" class="event-card-image-themed">
                                                    {% endif %}
                                                </a>
                                                <div class="news-one__date-box event-date-themed" style="background-color: rgba(108, 117, 125, 0.8);"> {# Greyish for past events #}
                                                    <p>{{ event_item.start_datetime|date:"d" }} <br> {{ event_item.start_datetime|date:"M" }} <br> {{ event_item.start_datetime|date:"Y" }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-8">
                                        <div class="news-one__content event-content-themed">
                                            <ul class="list-unstyled news-one__meta">
                                                {% if event_item.category %}
                                                    <li>
                                                        <i class="fas fa-folder-open"></i> 
                                                        {# If you removed category pages, just display the name, no link #}
                                                        {{ event_item.category.title }}
                                                    </li>
                                                {% endif %}
                                                {% if event_item.location_name %}
                                                     {% if event_item.category %}<li><span>/</span></li>{% endif %}
                                                    <li><i class="fas fa-map-marker-alt"></i> {{ event_item.location_name }}</li>
                                                {% endif %}
                                            </ul>
                                            <div class="news-one__title">
                                                <h3><a href="{{ event_item.get_absolute_url }}">{{ event_item.title }}</a></h3>
                                            </div>
                                            <p class="event-datetime-themed mb-2">
                                                <small><i class="fas fa-clock"></i> {{ event_item.start_datetime|date:"D, d M Y, P" }}
                                                {% if event_item.end_datetime %}
                                                    to {{ event_item.end_datetime|date:"P" }}
                                                {% endif %}
                                                </small>
                                            </p>
                                            <p class="event-description-themed">
                                                {{ event_item.description|striptags|truncatewords:20 }}
                                            </p>
                                            <a href="{{ event_item.get_absolute_url }}" class="thm-btn news-one__btn btn-outline-secondary">View Details</a> {# Different button style for past #}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-12">
                            <p>No past events to display yet.</p>
                        </div>
                    {% endfor %}
                </div>
                {% if past_events|length > 0 and past_events|length == 6 %}
                    {# <div class="text-center mt-4"> <a href="#" class="btn btn-info">View All Past Events</a> </div> #}
                {% endif %}
            </div>
            <!-- End Past Events Section -->
            {% if past_events %} 
                <div class="text-center mt-4">
                    <a href="{% url 'blogapp:all_past_events' %}" class="thm-btn">View All Past Events</a> {# Link to the new page #}
                </div>
            {% endif %}
        </div>
    </section>
    <!-- Events Page End -->

    <div class="search-popup">
        <div class="search-popup__overlay custom-cursor__overlay">
            <div class="cursor"></div>
            <div class="cursor-follower"></div>
        </div>
        <div class="search-popup__inner">
            <form action="{% url 'blogapp:event_search' %}" class="search-popup__form" method="GET">
                <input type="text" name="q" placeholder="Search Events....">
                <button type="submit"><i class="fa fa-search"></i></button>
            </form>
        </div>
    </div>

</div><!-- /.page-wrapper -->
<a href="#" data-target="html" class="scroll-to-target scroll-to-top"><i class="fa fa-angle-up"></i></a>
{% endblock %}